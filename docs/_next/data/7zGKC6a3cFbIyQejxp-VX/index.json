{"pageProps":{"posts":[{"summary":"マークダウンでブログ書く","tags":"[]","published_at":"2021-09-21T23:44:35+09:00[Asia/Tokyo]","content":["","# 形から入りがちなので、今回は中身からやってみる","","何かを始めるとき、形から入りがちである。「運動をするためにリングフィットアドベンチャーを買う」とか「プログラミングをするために MacBook Pro を買う」とか、そういう振る舞いである。これは非常によくない、なんとなれば、己の実力のなさという事実からの逃避だからだ。道具を買う暇があるなら、まず手を動かしてみるのがよいはずだ。手を動かしてみて「この道具ではいけないな」と思ってから道具を買えばいいのだ。","","で、私はなんでも形から入る逃避型人間なので、ブログを始めるときも「スタイルシートを書く」とか「CMS を作る」とか「デプロイ CI を回す」とかやってしまう。そしてブログ自体はなあなあにして終わる、つまり形から入って手を動かさない。一生こうだ、だがこれではいけない。なので、今回はとにかくマークダウンを書き、インターネットにポイっと置いてブログだと言い張ることにした。文字が読めればウェブログであることは疑いようもないので、たぶん大丈夫だろう。","","そういうわけでこれがブログである。GitHub にマークダウンを置いただけだ。シンプルでいい。たいていシンプルなアプローチこそ本質に迫るものだ。しかしシンプルだからこそ、 `Github` みたいなタイポを載せるとダサい…　そう思って textlint を導入した。何事も形が大事だからね。"],"id":"1","timestamp":1632235475},{"summary":"Linux でいいよもう","tags":"[Docker]","published_at":"2021-09-26T22:36:09+09:00[Asia/Tokyo]","content":["","# Docker Desktop for Macを止めてQEMUる","","Docker Desktopを止めると、「どこかにあるLinuxサーバーにアクセスして開発する」ことになります。この記事はこの図だけ覚えたら大丈夫です。","","![イメージ図](https://raw.githubusercontent.com/stakme/blog/main/assets/2/docker.png \"これが全てです\")","","つまりDocker Desktopは「あのGUI、別に使ってないよね。だからサブスクいらなくない？CLIしか使わないし」ではなくて、「本来dockerdのないmacOSでは不可能であるシームレスなマウントやポートフォワードを実現してくれるすごいやつ、GUIはおまけのサービス、Docker Desktopがなかったら相当つらい」です。私はなんとなく「macOSでdockerd相当の何かを動かす方法がある」と思っていましたが、そんなもの無いんですね。つらいね。","","世の中にはすごい人がたくさんいるので、すでに「limaを使えばいい」「podmanが使える」「Virtualboxがよい」などの様々な知見があります。今回は私の趣味によりそれらの便利レイヤーをすっ飛ばし、直接QEMUを操作するアプローチを試していきましょう。「VSCodeでそれっぽく開発できる」を目標として頑張ります。なおこの記事では「dockerdが動作しているUbuntuサーバー」をUbuntuさんと呼ぶことがあります。","","初期の原稿ではここにずらずらとシェルスクリプトを書いていたんですが、次第に最悪の記事になったのでリンク先へ移動しました。とはいえいちいち確認しなくても、日本語のテキストをなぞれば輪郭は掴めると思います。","","1. Docker Desktopをアンインストールします。そうするとdockerクライアントも消えるので、[手動でインストール](https://github.com/stakme/scripts/blob/main/docker/macos/install_docker.fish)します。これは単なるクライアントなので、dockerのコマンドは使えても`docker run`などは実現できません。","2. [QEMUでUbuntu Serverを動かす](https://github.com/stakme/scripts/blob/main/docker/macos/install_qemu.fish)準備をします。QEMUはコマンドがめちゃくちゃ長くて大変なので、専用スクリプトを使うと楽です。","3. [専用スクリプト`dockerhost.setup`](https://github.com/stakme/scripts/blob/main/docker/macos/qemu_setup.fish)を使ってサーバーを起動します。ウィンドウが開いてコンソールが表示されるので、ぽちぽちとUbuntu Serverを手動セットアップします。","4. ssh用のポートのみフォワーディングして、[ディスプレイなしでサーバーを起動](https://github.com/stakme/scripts/blob/main/docker/macos/qemu_run.fish)します。このとき`docker context`をいじっておけば、`docker context use`でデフォルト値が変更できるので楽です（デフォルト値を変更しないまま別途指定する`docker run -H ssh://...`みたいな書き方もできますし、`DOCKER_HOST`変数を使用することもできます）","5. サーバーを[いい感じに設定](https://github.com/stakme/scripts/blob/main/docker/macos/init_host.sh)してdockerdを動かします。","6. VSCodeからRemote-sshを使い、準備したUbuntuサーバーに接続します。","7. VSCodeからRemote-Containerを使い、準備したUbuntuサーバー上で`Clone Repository in Container Volume`を実行します。","8. VSCodeのすごい力により「Ubuntuにssh接続してUbuntu上で開発用コンテナを走らせてMacのVSCodeと繋ぐ」ことができました🎉やったね！","","重要なポイントとして、MacローカルからUbuntuで走るコンテナに直接アクセスすることはできません。つまりMacでターミナルを開いて、下記のような操作をすることはできません。","","```bash","# Macローカルで実行する","# sshをホスト指定すれば可能","docker run --publish 3306:3306 db;","","# どうやってもできない","mysql -h 0.0.0.0 -P 3306; ","```","","`docker run -p`はホストに対するポートフォワードの指定です。つまりこの`3306:3306`は、`localhost:3306`じゃなくて`ubuntuさん:3306`における公開なのですね。`localhost:3306`からここにアクセスするためには、さらにもう一段、sshでポートフォワーディングを行う必要があります。","","```bash","ssh -L 13306:localhost:3306 -p 10022 -Nf docker@localhost ","```","","これにより初めて`localhost:13306` -> `Ubuntuさん:3306` -> `コンテナさん:3306`というリレーが完成し、Macローカルからアクセス可能になります。[スクリプトも書きました](https://github.com/stakme/scripts/blob/main/docker/macos/qemu_port.fish)が地味にめんどくさいですね、理屈はわかるけど… とはいえ、これは面倒なだけで回避できるからまだいいです。","","回避できない重大な制約として、Macのディレクトリをボリュームとしてマウントできません。コンテナにマウントできるのはUbuntuのファイルシステムに存在するファイルだけであり、UbuntuさんとMacはいかなるファイルも共有していないからです。[sshfsで頑張ればイケる](https://apple.stackexchange.com/questions/420911/how-share-folder-in-qemu-with-plan9-virtfs-between-macos-host-and-linux-guest)という説もありますが、このソリューションもパッとみた感じ大変そう…","","この制約があるため、ひたすらMacではないところ（Ubuntu上またはコンテナ内部）でGitリポジトリをクローンし、そこに閉じた状態で作業することになります。感覚的にはインターネットの向こうにあるUbuntuサーバーで開発してるときと完全に同じです。Linuxに始まりLinuxで終わる開発、一生VSCodeを開き続ける人生。あえてmacOSを噛ませる意味とは一体… でもMacにはM1Xがあるから…","","参照した記事です。インターネットに🌞感謝🌝","","- [Docker Desktop for Macの実用的な代替手段: lima + Docker](https://qiita.com/yoichiwo7/items/44aff38674134ad87da3)","- [Docker Desktop 無しで Docker を使う with lima on Mac](https://korosuke613.hatenablog.com/entry/2021/09/18/docker-on-lima)","- [@toricls Docker Desktop なしで動いた✨ ……](https://twitter.com/toricls/status/1432925285377142789)","- [【podman machine】macOS上でPodmanを実行する新コマンドの紹介](https://rheb.hatenablog.com/entry/podman-machine)","- 業務中Slackにて「QEMUで動かせばいける」と具体的なコマンド群を教えてくれた[@octu0](https://twitter.com/octu0)"],"id":"2","timestamp":1632663369},{"summary":"なし","tags":"[]","published_at":"2021-11-03T14:36:45+09:00[Asia/Tokyo]","content":["","# 自分をラベリングするということ","","これは雑な文章です。はやくMacBook Pro届かないかな、発送が5週間後ってあんまりだよね、と思いながら書いています。アップルさん頑張って。","","昔、めちゃくちゃ給料が安かったころ… 具体的にいうと５年以上前に院卒で額面20万円以下（手当別、ボーナス無）の派遣IT社員だったころ、私は今と同じか、あるいは今より熱心な労働者だった。平日は出勤し、残業し、勉強をした。休日は勉強をした。睡眠時間を削り、眠るために酒を飲んだ。給料でありったけ本を買い、椅子を買い、机を買い、パソコンを買った。片っ端からプログラミング言語を触った。C, C++, C#, ObjC, Swift, Java, Kotlin, Scala, Erlang, Elixir, Ruby, Python, JavaScript, TypeScript, Haskellなどを（たぶん）学んだ。つまり、すごく頑張っていた。給料はずっと安かった。","","なんだかんだあったが、そのような学び方を数年続けた。この期間で、私は金を稼ぐ力の土台を作った。更になんだかんだあって、幾度かの転職をし、働く街が変わり、給与は2倍になり、3倍になった。病気で倒れることも、人生に行き詰まることもなかった。人に助けられた。運がよかった。","","で… なんだかんだあった現在の私からみると、昔の生活は自分に対する虐待だ。自分の熱意に比例しない給料への不満、低い評価しか受けられない自分に対する軽蔑。それらに基づく暴力だった。","","「こいつは無能」と自分にラベルを貼って、無能を制裁するためのカリキュラムを強制した。目標を設定しないまま学習ノルマだけを課した。ストレスの捌け口として自分をいじめて、無限に負荷をかけていた。ポキリと折れたらその場で死んでいた。あえて命を脅かすような振る舞いをして命懸けのストレス発散をやった。メチャクチャな経済的リスクの取りようはセルフ経済的DVといった様相だ。","","私の過去は変えられないし、現に私は死なずに生きているし、それで稼げるようになった側面もきっとある。だから「いい思い出だ」で済ませることもできるが、しかし、いま同じような境遇の人には伝えたいことがある。","","給料を上げたいなら、それを目標として最短距離を行けばいい。金を稼ごうとする自分を軽蔑しなくていい。学習に託けて自分を虐待しないでほしい。","","いまの私は、「給料分の仕事は定時で済ませた」という顔をし、なるべく残業を避ける。仕事を終えたら、かつて学んだ分野の新書を愛でてみたり（500ページを超える書籍は撫でるだけで賢い気分になれる効果がある）、人間用シャンプーで犬を洗ったり、「そして、バトンは渡された」を読んだりしている。掃除洗濯も日々それなりにやる。選挙の投票先について考える日もある。役所で手続きをする日もある。学習はそこそこ、気分が向いたらやる。","","きっと学習なんて、人々の生活においてその程度の重みしかないのだ。なにしろ人生には他のオプションが山ほどあるのだから。","","学習に打ち込んでもいい、仕事に熱中してもいい、でも自分をいじめないで。ちゃんと休みをとって、労ってあげてほしい。"],"id":"4","timestamp":1635917805},{"summary":"きっとブログを作れば毎日ちゃんと更新するはずなんだ","tags":"[next.js]","published_at":"2022-07-01T16:31:18+09:00[Asia/Tokyo]","content":["## ブログほしいよ〜！！","","ということで作っていくぞ","","### pjt.init","","- ステークホルダー: @stakme","- ゴール: ブログを書いて残せるようになる","- ミッション：","    1. ちょっと人の役に立つ情報を発信する","    2. 自己肯定感を爆上げする","- 指標：","    1. stak.me にアクセスできる","    2. 最低1記事のタイトル、本文、投稿日時が表示されている","- 得られる改善:","    - 今後の開発基盤が定まる","    - 毎日ブログを書かないとダメという雰囲気になる","- 実施期間: 2日","- 必要なリソース","    - 人間1名 (@stakme)","- 費用: 無料","- 売上: なし","","### pjt.plan","","合計10時間なり","","- フレームワーク選定 (2h)","    - バックエンド/CMSを必要としないこと (static site generator として機能すること)","    - CIによる自動反映が可能であること","    - Twitter Card に対応可能であること","    - ルーティング周辺に手を入れやすいこと、サイト構成が変わってもリダイレクト的な体験を作る見込みがあること","    - 程よく車輪を再発明すること（そういう遊びなので）","- フレームワーク導入 (1h)","- stak.me 更新 (2h)","    - 何かが出ていればok","    - 当面、手動更新でよい","- マークダウンをhtmlに組み立てるいい感じの処理 (3h)","    - パーサーは手書きする","- タイトル、本文、投稿日時を表示する (2h)","","","### pjt.exec","","- twitterのログを見ると、10:32 ~ 16:24 作業してる","- 実際には2.5時間くらい離席したり昼寝したりしてるので、2時間弱で終了しているみたい","- 実装計画、ガバガバのガバ","","https://twitter.com/stakme/status/1542682434453458945","https://twitter.com/stakme/status/1542771078732587009","","### pjt.close","","- 測定可能な指標はクリアしているので…","- ふりかえり:","    - 着手前に計画を立てたのがよかった（小学生並の感想）","        - 個人の趣味でやるとき「何も考えずバーっと作り始めてそのまま完成せずお蔵入りになるパターン」が多すぎて流石に学んだ","        - プロジェクトマネジメントを学んでいこうな！","    - 指標が最低限だったので即終わった","        - これもかなり当たり前のことだが…","        - 指標に書いてないからな〜で見栄えを全部捨てたので、作業内容が発散しないで済んだ","        - 趣味活動、ついついタスクコントロールを捨てて細かいことに時間をかけて飽きがち","- 記事ページはあるが、トップページがないので、まずはそこを作りたい","- 見た目の改善はそのあとかな… たぶんPrettier入れます"],"id":"5","timestamp":1656660678},{"summary":"トップページつくった","tags":"[next.js]","published_at":"2022-07-02T00:29:51+09:00[Asia/Tokyo]","content":["","トップページに遷移できるようになりました。まるでWebサイトみたいだ…","","### pjt.init","","- goal: サイト利用者からみて、コンテンツが現実的に利用可能な状態する","- measurable objectives:","    1. stak.me にアクセスすると、直近の記事タイトル、本文、投稿日時が表示されている","    1. 各記事にサイト名が表示されている","    2. トップと記事でリンク遷移できる","- improvements:","    - ブログっぽい雰囲気が増してくる","- 実施期間: 0.2日","- 必要なリソース","    - 人間1名 (@stakme)","- 費用: 無料","- 売上: なし","","### pjt.plan","","- トップページに記事一覧を出す (0.5h)","    - 本当は「直近10件」などの基準に基づく実装が必要","    - 現状、まだ10記事ないので全部出しておけばok","    - マークダウンの内容に基づいてソートするのはパーサー実装が必要なので先送り","- 記事の上のほうにサイト名を書いてリンク貼る (0.5h)","    - サイト名なんだっけ？","    - その場のノリで決めてok","","### pjt.exec","","- 進捗は特筆すべきことなし、一瞬で終わった","","### pjt.close","","- 今回も測定可能な指標はクリアしておりますので…","- ふりかえり:","    - 作業は大したことないが、作業時間が取れなかった","    - 流石にこの見た目、そろそろ治したほうが良くない？"],"id":"blog-pjt-top-page","timestamp":1656689391},{"summary":"パーサー改良した","tags":"[next.js]","published_at":"2022-07-05T10:21:04+09:00[Asia/Tokyo]","content":["","### pjt.init","","- goal: 情報を整理して表示し、読み取りやすくする","- measurable objectives:","    1. 記事作成日に基づいてトップページがソートされている","    1. 各記事の先頭に、読み取りやすく作成日が表示されている","- improvements:","    - デザイン改善の基盤が改善される","- 実施期間: 0.5日?","- 必要なリソース","    - 人間1名 (@stakme)","- 費用: 無料","- 売上: なし","","### pjt.plan","","- メタデータ部分を読み取るPEG改修 (3h)","- デザイン対応 (1h)","","### pjt.exec","","- けっこう手間取ってしまった（3時間くらい）が計測を忘れていた…","- ビルド時にdocs/CNAMEが都度削除されてしまう問題をついでに直しておく","","### pjt.close","","- このブログは他のタスクに優先度で負けているので、なかなか進まないが、一応ちょっとずつ進歩しています","- 次はTypeScript入れたりlint入れたりprettier入れたりすると思う、そこまで行ったらもうちょい釈明できる見た目にするので…","- CIビルドもしたいけれど…　まあそれは更に後になりそう"],"id":"blog-pjt-002-meta-data","timestamp":1656984064}]},"__N_SSG":true}